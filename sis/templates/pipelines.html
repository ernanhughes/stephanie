{# sis/templates/pipelines.html #}
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">📊 Pipeline Runs</h1>
    <a href="/models" class="btn btn-outline-primary">View Models</a>
  </div>

  {% if runs %}
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Tag</th>
          <th>Description</th>
          <th>Started</th>
          <th>Duration</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for run in runs %}
        <tr>
          <td>{{ run.id }}</td>
          <td>{{ run.name or "-" }}</td>
          <td>{{ run.tag or "-" }}</td>
          <td>{{ run.description or "-" }}</td>
          <td>{{ run.created_at }}</td>
          <td>
            {% if run.stages %}
              {% set start = run.stages[0].timestamp %}
              {% set end = run.stages[-1].timestamp %}
              {% if start and end %}
                {{ (end - start).total_seconds() | int }}s
              {% else %}
                -
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            <div class="d-flex gap-2">
              <a href="/pipeline/{{ run.id }}" class="btn btn-sm btn-primary">View</a>
              <a href="/plan_traces/{{ run.id }}" class="btn btn-sm btn-outline-secondary">
                Plan Traces
                {% if run.plan_traces %}
                  <span class="badge bg-info">{{ run.plan_traces|length }}</span>
                {% endif %}
              </a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-warning">
      ⚠️ No pipelines found.
    </div>
  {% endif %}
</div>
{% endblock %}
