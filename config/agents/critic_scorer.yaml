critic_scorer:
  _target_: stephanie.components.critic.agents.critic_scorer.CriticScorerAgent
  name: critic_scorer
  input_key: scorables
  output_key: critic_results
  enabled: true

  model_path: "models/critic.joblib"
  meta_path:  "models/critic.meta.json"
 
  # ------------------------------------------------------------
  # ScorableProcessor configuration
  # ------------------------------------------------------------
  processor:
    _target_: stephanie.scoring.metrics.scorable_processor.ScorableProcessor

    # Inline mode â€” fast and simple
    offload_mode: inline

    # No manifest for critic runs (fast)
    enable_manifest: false

    # Disable expensive features
    enable_item_progress: false
    persist_vpm_png: false
    save_vpm_channels: false
    require_metrics_for_vpm: false
    attach_scores: true

    # What features to run for the critic pipeline
    features:
      - metrics        # generates metrics_vector, columns, values
      - visicalc       # runs cohort analysis using those metrics

    # Feature-specific sub-configs
    feature_configs:

      metrics:
        enabled: true
        scorers: ["hrm", "sicql", "tiny"]
        dimensions:
          - coverage
          - reasoning
          - knowledge
          - clarity
          - faithfulness
        persist: false

      visicalc:
        enabled: true

        # Preferred metrics order override
        metric_keys:
          - "HRM.coverage.score"
          - "sicql.coverage.score"
          - "tiny.coverage.score"

        frontier_metric: "HRM.aggregate"
        row_region_splits: 4
        frontier_low: 0.25
        frontier_high: 0.75

        # Output settings
        out_dir: "runs/visicalc"
        json_file: "visicalc_report.json"
        csv_file:  "visicalc_report.csv"

        # Include/exclude mapping for metric selection
        metric_mapping:
          include:
            - "HRM.*"
            - "sicql.*"
            - "tiny.*"
          exclude:
            - "*.raw"
            - "*.debug"

        # Optional VPM output for visual inspection
        vpm_png:
          enabled: true
          mode: "L"            # grayscale
          per_metric_normalize: true
          target_file: "visicalc_targeted_vpm.png"
          baseline_file: "visicalc_baseline_vpm.png"

        # Metric importance / Cohen's d filters
        top_k_metrics: 50
        min_effect: 0.25

        importance_filter:
          enabled: true
          path: "config/core_metrics.json"
          top_k: 150
          min_effect: 0.1

    metrics_filter:
      enabled: true
      top_k: 100           # 50 / 100 / 150
      normalize: true
      dup_threshold: 0.995
      min_variance: 1e-8
      include:             # optional, supports * wildcards
        - "HRM.*"
        - "sicql.*"
        - "tiny.*"
      exclude:
        - "*.raw"
        - "*.debug"
        - "*.stdev"        # if you decide to exclude SD-only channels
